# PHL-Expansion

## Token Spec

```yaml
Name:           PHL-Expansion
Intent:         현재 모듈을 확장 가능하고 견고하게 만든다
Scope:          사용자가 지정한 모듈/파일/디렉토리
Non-Goals:
  - 새 기능 추가 (별도 토큰으로)
  - UI/UX 변경
  - 의존성 추가 (필요 시 질문)
Preconditions:
  - 대상 모듈이 존재할 것
  - 현재 테스트가 통과 상태일 것 (없으면 먼저 생성)
```

---

## Procedure (단계별 수행)

### Step 1: 현재 상태 파악
- [ ] 대상 모듈의 파일 구조 읽기
- [ ] 기존 에러 처리 패턴 파악
- [ ] 기존 로깅 패턴 파악
- [ ] 기존 테스트 존재 여부 확인
- [ ] 의존성/인터페이스 경계 식별

### Step 2: 에러 처리 강화
- [ ] 모든 외부 호출에 명시적 try/catch 또는 에러 리턴
- [ ] 에러 메시지에 컨텍스트 포함 (어디서, 왜, 어떤 입력)
- [ ] 리턴 타입 안정화 (null/undefined 대신 명시적 Result 또는 에러 객체)
- [ ] 에러 전파 경로 명확화 (어디서 잡고 어디로 전달하는지)

### Step 3: 로깅 추가
- [ ] 함수 진입/종료 로그 (핵심 함수만)
- [ ] 에러 발생 지점 로그 (에러 객체 + 입력값)
- [ ] 핵심 분기 로그 (if/else에서 어느 쪽으로 갔는지)
- [ ] `/phl/contracts/logging.md` 포맷 준수

### Step 4: 인터페이스 정리
- [ ] 하나의 함수가 하나의 책임만 (SRP 방향)
- [ ] 매개변수 3개 초과 시 객체로 묶기
- [ ] 내부 구현과 외부 인터페이스 분리
- [ ] 불필요한 의존성 제거

### Step 5: 테스트 추가
- [ ] 정상 경로(happy path) 테스트
- [ ] 에러 경로(error path) 테스트 — 각 에러 처리 분기마다
- [ ] 경계값 테스트 (빈 입력, null, 최대값)
- [ ] 기존 테스트 깨지지 않는지 확인

---

## Validation (성공 판정)

- [ ] 모든 테스트 통과
- [ ] 린트/타입 체크 통과 (해당 시)
- [ ] 빌드 성공 (해당 시)
- [ ] 기존 기능 regression 없음

---

## Artifacts (산출물)

| 유형 | 설명 |
|------|------|
| 수정된 모듈 | 에러 처리 + 로깅 + 인터페이스 정리 |
| 테스트 파일 | 정상/에러/경계값 경로 |
| CHANGELOG | 변경 사항 기록 (있는 경우) |

---

## Commit Policy

```
PHL-Expansion: <module> - <summary>

- 에러 처리: [변경 내용]
- 로깅: [변경 내용]
- 인터페이스: [변경 내용]
- 테스트: [추가/수정 내용]

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
```

---

## Rollback Policy

- 테스트 실패 시: 변경 전 상태로 `git revert`
- 부분 성공 시: 성공한 부분만 커밋, 실패 부분은 로그로 남김
- 의존성 충돌 시: 사용자에게 질문 후 판단

---

## Questions Policy

다음 상황에서 반드시 질문:
- "어느 모듈에 적용합니까?" (범위 미지정 시)
- "기존 에러 처리 패턴을 유지합니까, 새 패턴으로 통일합니까?"
- "테스트 프레임워크는 무엇을 사용합니까?" (프로젝트에 테스트가 없는 경우)
- "로깅 라이브러리/방식은?" (프로젝트에 로깅이 없는 경우)
