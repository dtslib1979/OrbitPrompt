<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>ì¶”ëª¨ ë‹¤í â€” Chalkboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0a;
      --bg-card: #141414;
      --bg-input: #1a1a1a;
      --text: #f5f5f5;
      --text-dim: rgba(255,255,255,0.5);
      --accent: #d4af37;
      --accent-dim: rgba(212,175,55,0.2);
      --border: rgba(255,255,255,0.1);
      --serif: 'Noto Serif KR', Georgia, serif;
      --sans: 'Inter', -apple-system, sans-serif;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width: 100%; height: 100%;
      background: var(--bg);
      font-family: var(--sans);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
    }

    /* ========== SETUP MODE ========== */
    .setup {
      min-height: 100vh;
      padding: 1rem;
      overflow-y: auto;
    }
    .setup.hidden { display: none; }

    .setup-header {
      text-align: center;
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }
    .setup-title {
      font-family: var(--serif);
      font-size: 1.5rem;
      font-weight: 500;
    }
    .setup-subtitle {
      font-size: 0.75rem;
      color: var(--text-dim);
      margin-top: 0.25rem;
    }

    /* Instructions */
    .instructions {
      background: var(--accent-dim);
      border: 1px solid var(--accent);
      padding: 1rem;
      margin-bottom: 1.5rem;
      font-size: 0.75rem;
      line-height: 1.6;
    }
    .instructions h3 {
      font-size: 0.6875rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }
    .instructions ul {
      margin-left: 1rem;
      color: var(--text-dim);
    }
    .instructions li { margin-bottom: 0.25rem; }
    .instructions code {
      background: rgba(0,0,0,0.3);
      padding: 0.1rem 0.3rem;
      font-size: 0.6875rem;
    }

    /* Form sections */
    .form-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      margin-bottom: 1rem;
      padding: 1rem;
    }
    .form-section-title {
      font-size: 0.6875rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .form-section-title::before {
      content: '';
      width: 12px;
      height: 1px;
      background: var(--accent);
    }

    /* Form rows */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    @media (max-width: 480px) {
      .form-row { grid-template-columns: 1fr; }
    }
    .form-row.full { grid-template-columns: 1fr; }

    .form-group { display: flex; flex-direction: column; gap: 0.25rem; }
    .form-label {
      font-size: 0.625rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    .form-input, .form-textarea {
      background: var(--bg-input);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: inherit;
      font-size: 0.875rem;
      padding: 0.625rem;
      transition: border-color 0.15s;
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    .form-textarea { resize: vertical; min-height: 60px; }

    /* Section cards */
    .section-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      margin-bottom: 1rem;
    }
    .section-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
    }
    .section-card-num {
      font-size: 0.6875rem;
      color: var(--accent);
      font-weight: 600;
    }
    .section-card-title {
      flex: 1;
      margin-left: 0.75rem;
      font-size: 0.875rem;
    }
    .section-card-toggle {
      font-size: 0.75rem;
      color: var(--text-dim);
    }
    .section-card-body {
      padding: 1rem;
      display: none;
    }
    .section-card.open .section-card-body { display: block; }
    .section-card.open .section-card-toggle { transform: rotate(180deg); }

    /* Image preview */
    .image-preview {
      width: 100%;
      height: 120px;
      background: var(--bg-input);
      border: 1px dashed var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 0.5rem;
      overflow: hidden;
    }
    .image-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }
    .image-preview-placeholder {
      font-size: 0.75rem;
      color: var(--text-dim);
    }

    /* Buttons */
    .btn-row {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    .btn {
      flex: 1;
      padding: 1rem;
      border: none;
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-primary {
      background: var(--accent);
      color: #000;
    }
    .btn-primary:hover { filter: brightness(1.1); }
    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }
    .btn-secondary:hover { border-color: var(--accent); }

    .btn-small {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }

    /* ========== BROADCAST MODE ========== */
    .broadcast {
      position: fixed;
      inset: 0;
      display: none;
    }
    .broadcast.active { display: block; }

    .section {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1.5s ease;
    }
    .section.active {
      opacity: 1;
      pointer-events: auto;
    }

    .bg-image {
      position: absolute;
      inset: -10%;
      width: 120%;
      height: 120%;
      background-size: cover;
      background-position: center;
      z-index: -1;
    }

    @keyframes kb-zoom-in { from { transform: scale(1); } to { transform: scale(1.15); } }
    @keyframes kb-zoom-out { from { transform: scale(1.15); } to { transform: scale(1); } }
    @keyframes kb-pan-left { from { transform: scale(1.1) translateX(5%); } to { transform: scale(1.1) translateX(-5%); } }
    @keyframes kb-pan-right { from { transform: scale(1.1) translateX(-5%); } to { transform: scale(1.1) translateX(5%); } }

    .kb-zoom-in { animation: kb-zoom-in 15s ease-out forwards; }
    .kb-zoom-out { animation: kb-zoom-out 15s ease-out forwards; }
    .kb-pan-left { animation: kb-pan-left 15s ease-out forwards; }
    .kb-pan-right { animation: kb-pan-right 15s ease-out forwards; }

    .filter-grayscale { filter: grayscale(100%) contrast(1.1); }
    .filter-high-contrast { filter: grayscale(70%) contrast(1.3) brightness(0.9); }
    .filter-sepia { filter: sepia(30%) contrast(1.1); }
    .filter-warm { filter: sepia(15%) saturate(1.2) brightness(1.05); }
    .filter-soft { filter: brightness(1.1) contrast(0.95) saturate(0.9); }

    .overlay {
      position: absolute;
      inset: 0;
      z-index: 0;
    }
    .overlay-dark {
      background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 30%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0.8) 100%);
    }
    .overlay-vignette {
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
    }

    .content {
      position: relative;
      z-index: 1;
      text-align: center;
      max-width: 800px;
      font-family: var(--serif);
    }

    .section-num {
      font-family: var(--sans);
      font-size: 0.625rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 1rem;
    }
    .title {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 400;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 20px rgba(0,0,0,0.8);
    }
    .subtitle {
      font-size: clamp(0.875rem, 2.5vw, 1.125rem);
      font-weight: 300;
      color: var(--text-dim);
      font-style: italic;
      margin-bottom: 2rem;
    }
    .quote {
      font-size: clamp(1.25rem, 4vw, 2rem);
      font-weight: 300;
      font-style: italic;
      line-height: 1.8;
      max-width: 700px;
      margin: 0 auto;
      padding: 2rem;
      border-left: 2px solid var(--accent);
      text-align: left;
      background: rgba(0,0,0,0.3);
    }
    .quote-source {
      margin-top: 1rem;
      font-size: 0.875rem;
      color: var(--accent);
      font-style: normal;
    }

    .timeline {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.5rem;
      z-index: 100;
    }
    .timeline-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.5s;
    }
    .timeline-dot.active { background: var(--accent); box-shadow: 0 0 10px var(--accent); }
    .timeline-dot.done { background: rgba(255,255,255,0.5); }

    .nav-hint {
      position: fixed;
      bottom: 4rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.6875rem;
      color: rgba(255,255,255,0.3);
      letter-spacing: 0.1em;
      z-index: 100;
    }

    .exit-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      color: rgba(255,255,255,0.5);
      padding: 0.5rem 0.75rem;
      font-size: 0.625rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      z-index: 100;
    }
    .exit-btn:hover { border-color: var(--accent); color: var(--accent); }

    .touch-left { position: fixed; left: 0; top: 0; width: 30%; height: 100%; z-index: 50; }
    .touch-right { position: fixed; right: 0; top: 0; width: 70%; height: 100%; z-index: 50; }

    .final-screen { background: linear-gradient(180deg, #0a0a0a 0%, #000 100%); }
    .final-name { font-size: clamp(2rem, 6vw, 3.5rem); font-weight: 500; margin-bottom: 0.5rem; }
    .final-title { font-size: clamp(1rem, 3vw, 1.5rem); color: var(--text-dim); margin-bottom: 1rem; }
    .final-years { font-size: clamp(1.25rem, 4vw, 2rem); letter-spacing: 0.3em; color: var(--accent); margin-bottom: 2rem; }
    .final-message { font-size: 1rem; color: var(--text-dim); font-style: italic; }

    @keyframes fade-up {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .section.active .content > * { animation: fade-up 1s ease forwards; }
    .section.active .content > *:nth-child(1) { animation-delay: 0.3s; opacity: 0; }
    .section.active .content > *:nth-child(2) { animation-delay: 0.6s; opacity: 0; }
    .section.active .content > *:nth-child(3) { animation-delay: 0.9s; opacity: 0; }
    .section.active .content > *:nth-child(4) { animation-delay: 1.2s; opacity: 0; }
  </style>
</head>
<body>

<!-- ========== SETUP MODE ========== -->
<div class="setup" id="setupMode">
  <div class="setup-header">
    <h1 class="setup-title">ì¶”ëª¨ ë‹¤í í…œí”Œë¦¿</h1>
    <p class="setup-subtitle">Ken Burns ìŠ¤íƒ€ì¼ ë‹¤íë©˜í„°ë¦¬</p>
  </div>

  <div class="instructions">
    <h3>ì‚¬ìš©ë²•</h3>
    <ul>
      <li><strong>ì´ë¯¸ì§€:</strong> ê° ì„¹ì…˜ì— <code>1200x800</code> ì´ìƒ ì´ë¯¸ì§€ URL ì…ë ¥</li>
      <li><strong>ë¡œì»¬ ì´ë¯¸ì§€:</strong> <code>../assets/images/íŒŒì¼ëª….jpg</code> í˜•ì‹ìœ¼ë¡œ ê²½ë¡œ ì…ë ¥</li>
      <li><strong>ë¬´ë£Œ ì´ë¯¸ì§€:</strong> Unsplashì—ì„œ <code>https://images.unsplash.com/photo-xxx?w=1200</code></li>
      <li><strong>ì €ì¥:</strong> ì…ë ¥ í›„ [ì €ì¥] ë²„íŠ¼ â†’ localStorageì— ì €ì¥ë¨</li>
      <li><strong>ë°©ì†¡:</strong> [ë°©ì†¡ ì‹œì‘] ë²„íŠ¼ â†’ Galaxy í™”ë©´ ë…¹í™” ì‹œì‘</li>
    </ul>
  </div>

  <!-- ì¸ë¬¼ ì •ë³´ -->
  <div class="form-section">
    <div class="form-section-title">ì¸ë¬¼ ì •ë³´</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ì´ë¦„</label>
        <input type="text" class="form-input" id="subjectName" placeholder="ì˜ˆ: ì´í•´ì°¬">
      </div>
      <div class="form-group">
        <label class="form-label">ì§í•¨</label>
        <input type="text" class="form-input" id="subjectTitle" placeholder="ì˜ˆ: ì „ êµ­ë¬´ì´ë¦¬">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ìƒëª°ë…„</label>
        <input type="text" class="form-input" id="subjectYears" placeholder="ì˜ˆ: 1952 â€” 2025">
      </div>
      <div class="form-group">
        <label class="form-label">ë§ˆë¬´ë¦¬ ë©”ì‹œì§€</label>
        <input type="text" class="form-input" id="finalMessage" placeholder="ì˜ˆ: ì˜ì›íˆ ê¸°ì–µí•˜ê² ìŠµë‹ˆë‹¤">
      </div>
    </div>
  </div>

  <!-- ì„¹ì…˜ë“¤ -->
  <div id="sectionCards"></div>

  <!-- ë²„íŠ¼ -->
  <div class="btn-row">
    <button class="btn btn-secondary" onclick="saveData()">ğŸ’¾ ì €ì¥</button>
    <button class="btn btn-secondary" onclick="loadSample()">ğŸ“‹ ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>
  <div class="btn-row">
    <button class="btn btn-secondary" onclick="exportJSON()">ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
    <button class="btn btn-primary" onclick="startBroadcast()">â–¶ ë°©ì†¡ ì‹œì‘</button>
  </div>
</div>

<!-- ========== BROADCAST MODE ========== -->
<div class="broadcast" id="broadcastMode">
  <div id="memorial"></div>
  <div class="timeline" id="timeline"></div>
  <div class="nav-hint">TAP TO CONTINUE</div>
  <button class="exit-btn" onclick="exitBroadcast()">âœ• EXIT</button>
  <div class="touch-left" id="touchLeft"></div>
  <div class="touch-right" id="touchRight"></div>
</div>

<script>
  // ì„¹ì…˜ ê¸°ë³¸ êµ¬ì¡°
  const defaultSections = [
    { num: '01', defaultTitle: 'ìš´ëª…ì˜ ì‹œì‘', defaultSubtitle: 'ì‹œì‘ì ', filter: 'filter-grayscale', kenBurns: 'kb-zoom-in' },
    { num: '02', defaultTitle: 'íˆ¬ì‚¬ì˜ ì‹œëŒ€', defaultSubtitle: 'ì„±ì¥ê¸°', filter: 'filter-high-contrast', kenBurns: 'kb-pan-left' },
    { num: '03', defaultTitle: 'ë¦¬ë”ì˜ ë¬´ê²Œ', defaultSubtitle: 'ì „ì„±ê¸°', filter: 'filter-sepia', kenBurns: 'kb-zoom-out' },
    { num: '04', defaultTitle: 'ì¸ê°„ì  ë©´ëª¨', defaultSubtitle: 'ì—¬ìœ ', filter: 'filter-warm', kenBurns: 'kb-pan-right' },
    { num: '05', defaultTitle: 'ì˜ì›í•œ ì•ˆì‹', defaultSubtitle: '', filter: 'filter-soft', kenBurns: 'kb-zoom-in', isFinal: true }
  ];

  // ìƒ˜í”Œ ë°ì´í„°
  const sampleData = {
    subject: { name: 'ì´í•´ì°¬', title: 'ì „ êµ­ë¬´ì´ë¦¬', years: '1952 â€” 2025' },
    finalMessage: 'ì˜ì›íˆ ê¸°ì–µí•˜ê² ìŠµë‹ˆë‹¤',
    sections: [
      { title: 'ìš´ëª…ì˜ ì‹œì‘', subtitle: '1972ë…„ 10ì›” 17ì¼', quote: '10ì›” 17ì¼ì´ ì œ ì¸ìƒì„ ë°”ê¾¼ ë‚ ì…ë‹ˆë‹¤.', quoteSource: 'â€” ì´í•´ì°¬, íšŒê³ ë¡ì—ì„œ', bgImage: 'https://images.unsplash.com/photo-1532375810709-75b1da00537c?w=1200' },
      { title: 'íˆ¬ì‚¬ì˜ ì‹œëŒ€', subtitle: 'ë¯¼ì£¼í™”ì™€ ì²­ë¬¸íšŒ', quote: 'ê±¸ë ˆëŠ” ë¹¨ì•„ë„ ê±¸ë ˆì…ë‹ˆë‹¤.', quoteSource: 'â€” 1988ë…„ 5ê³µ ì²­ë¬¸íšŒì—ì„œ', bgImage: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?w=1200' },
      { title: 'ë¦¬ë”ì˜ ë¬´ê²Œ', subtitle: 'ì´ë¦¬, ê·¸ë¦¬ê³  ë‹¹ëŒ€í‘œ', quote: 'ì´ê²ƒì´ ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ì˜ ì—­ì‚¬ì…ë‹ˆë‹¤.', quoteSource: 'â€” ë‹¹ëŒ€í‘œ ìˆ˜ë½ ì—°ì„¤ì—ì„œ', bgImage: 'https://images.unsplash.com/photo-1541872703-74c5e44368f9?w=1200' },
      { title: 'ì¸ê°„ ì´í•´ì°¬', subtitle: 'ì—¬ìœ ì™€ í•´í•™', quote: 'ë…ì¬í•˜ê³  ì‹¸ìš°ë‹¤ê°€...\nì§€ê¸ˆ ì•¼ë‹¹ì€ ê°€ì§œ ê°™ì•„ì„œ ì‹¸ìš°ëŠ” ì¬ë¯¸ê°€ ì—†ë‹¤.', quoteSource: 'â€” í›„ë°° ì˜ì›ë“¤ì—ê²Œ', bgImage: 'https://images.unsplash.com/photo-1517486808906-6ca8b3f04846?w=1200' },
      { title: 'ì˜ì›í•œ ì•ˆì‹', subtitle: '', quote: 'êµ­ë¯¼ë“¤ê»˜ ë§ì€ ì„±ì›ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.\nê²°ì½” ìŠì§€ ì•Šê² ìŠµë‹ˆë‹¤.', quoteSource: 'â€” ë§ˆì§€ë§‰ ì¸ì‚¬', bgImage: '' }
    ]
  };

  // ì„¹ì…˜ ì¹´ë“œ ë Œë”ë§
  function renderSectionCards() {
    const container = document.getElementById('sectionCards');
    container.innerHTML = defaultSections.map((s, i) => `
      <div class="section-card ${i === 0 ? 'open' : ''}" data-index="${i}">
        <div class="section-card-header" onclick="toggleCard(${i})">
          <span class="section-card-num">${s.num}</span>
          <span class="section-card-title">${s.defaultTitle}</span>
          <span class="section-card-toggle">â–¼</span>
        </div>
        <div class="section-card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">ì„¹ì…˜ ì œëª©</label>
              <input type="text" class="form-input" id="sec${i}_title" placeholder="${s.defaultTitle}">
            </div>
            <div class="form-group">
              <label class="form-label">ë¶€ì œ</label>
              <input type="text" class="form-input" id="sec${i}_subtitle" placeholder="${s.defaultSubtitle}">
            </div>
          </div>
          <div class="form-row full">
            <div class="form-group">
              <label class="form-label">ì¸ìš©ë¬¸</label>
              <textarea class="form-textarea" id="sec${i}_quote" placeholder="í•µì‹¬ ë©˜íŠ¸"></textarea>
            </div>
          </div>
          <div class="form-row full">
            <div class="form-group">
              <label class="form-label">ì¸ìš© ì¶œì²˜</label>
              <input type="text" class="form-input" id="sec${i}_quoteSource" placeholder="â€” ì¶œì²˜">
            </div>
          </div>
          ${s.isFinal ? '' : `
          <div class="form-row full">
            <div class="form-group">
              <label class="form-label">ë°°ê²½ ì´ë¯¸ì§€ URL</label>
              <input type="text" class="form-input" id="sec${i}_bgImage" placeholder="https://..." oninput="previewImage(${i})">
              <div class="image-preview" id="sec${i}_preview">
                <span class="image-preview-placeholder">ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</span>
              </div>
            </div>
          </div>
          `}
        </div>
      </div>
    `).join('');
  }

  function toggleCard(index) {
    const card = document.querySelector(`.section-card[data-index="${index}"]`);
    card.classList.toggle('open');
  }

  function previewImage(index) {
    const url = document.getElementById(`sec${index}_bgImage`).value;
    const preview = document.getElementById(`sec${index}_preview`);
    if (url) {
      preview.innerHTML = `<img src="${url}" onerror="this.parentElement.innerHTML='<span class=image-preview-placeholder>ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</span>'">`;
    } else {
      preview.innerHTML = '<span class="image-preview-placeholder">ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</span>';
    }
  }

  // ë°ì´í„° ìˆ˜ì§‘
  function collectData() {
    const data = {
      subject: {
        name: document.getElementById('subjectName').value || 'ì´ë¦„',
        title: document.getElementById('subjectTitle').value || 'ì§í•¨',
        years: document.getElementById('subjectYears').value || '0000 â€” 0000'
      },
      finalMessage: document.getElementById('finalMessage').value || 'ì˜ì›íˆ ê¸°ì–µí•˜ê² ìŠµë‹ˆë‹¤',
      sections: defaultSections.map((s, i) => ({
        num: s.num,
        title: document.getElementById(`sec${i}_title`).value || s.defaultTitle,
        subtitle: document.getElementById(`sec${i}_subtitle`).value || s.defaultSubtitle,
        quote: document.getElementById(`sec${i}_quote`).value || '',
        quoteSource: document.getElementById(`sec${i}_quoteSource`).value || '',
        bgImage: document.getElementById(`sec${i}_bgImage`)?.value || '',
        filter: s.filter,
        kenBurns: s.kenBurns,
        isFinal: s.isFinal || false
      }))
    };
    return data;
  }

  // ë°ì´í„° ì±„ìš°ê¸°
  function fillData(data) {
    document.getElementById('subjectName').value = data.subject.name;
    document.getElementById('subjectTitle').value = data.subject.title;
    document.getElementById('subjectYears').value = data.subject.years;
    document.getElementById('finalMessage').value = data.finalMessage || '';

    data.sections.forEach((s, i) => {
      document.getElementById(`sec${i}_title`).value = s.title || '';
      document.getElementById(`sec${i}_subtitle`).value = s.subtitle || '';
      document.getElementById(`sec${i}_quote`).value = s.quote || '';
      document.getElementById(`sec${i}_quoteSource`).value = s.quoteSource || '';
      const bgInput = document.getElementById(`sec${i}_bgImage`);
      if (bgInput) {
        bgInput.value = s.bgImage || '';
        previewImage(i);
      }
    });
  }

  // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
  function saveData() {
    const data = collectData();
    localStorage.setItem('memorial-tribute-data', JSON.stringify(data));
    alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }

  function loadData() {
    const saved = localStorage.getItem('memorial-tribute-data');
    if (saved) {
      fillData(JSON.parse(saved));
    }
  }

  function loadSample() {
    fillData(sampleData);
  }

  function exportJSON() {
    const data = collectData();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `memorial-${data.subject.name || 'tribute'}.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  // ========== BROADCAST MODE ==========
  let currentSection = 0;
  let broadcastData = null;

  function startBroadcast() {
    broadcastData = collectData();

    // ì´ë¯¸ì§€ ì²´í¬
    const hasImages = broadcastData.sections.slice(0, -1).some(s => s.bgImage);
    if (!hasImages) {
      if (!confirm('ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    }

    document.getElementById('setupMode').classList.add('hidden');
    document.getElementById('broadcastMode').classList.add('active');

    currentSection = 0;
    renderBroadcast();
  }

  function exitBroadcast() {
    document.getElementById('broadcastMode').classList.remove('active');
    document.getElementById('setupMode').classList.remove('hidden');
  }

  function renderBroadcast() {
    const memorial = document.getElementById('memorial');
    const sections = broadcastData.sections;

    memorial.innerHTML = sections.map((s, i) => {
      if (s.isFinal) {
        return `
          <div class="section final-screen ${i === 0 ? 'active' : ''}" data-index="${i}">
            <div class="overlay overlay-vignette"></div>
            <div class="content">
              <div class="section-num">${s.num}</div>
              <div class="final-name">${broadcastData.subject.name}</div>
              <div class="final-title">${broadcastData.subject.title}</div>
              <div class="final-years">${broadcastData.subject.years}</div>
              <div class="quote" style="border:none;text-align:center;background:transparent;">
                ${(s.quote || '').replace(/\n/g, '<br>')}
                <div class="quote-source">${s.quoteSource || ''}</div>
              </div>
              <div class="final-message">${broadcastData.finalMessage}</div>
            </div>
          </div>
        `;
      }
      return `
        <div class="section ${i === 0 ? 'active' : ''}" data-index="${i}">
          <div class="bg-image ${s.filter} ${s.kenBurns}" style="background-image:url('${s.bgImage}')"></div>
          <div class="overlay overlay-dark"></div>
          <div class="overlay overlay-vignette"></div>
          <div class="content">
            <div class="section-num">${s.num}</div>
            <div class="title">${s.title}</div>
            <div class="subtitle">${s.subtitle}</div>
            <div class="quote">
              ${(s.quote || '').replace(/\n/g, '<br>')}
              <div class="quote-source">${s.quoteSource || ''}</div>
            </div>
          </div>
        </div>
      `;
    }).join('');

    renderTimeline();
  }

  function renderTimeline() {
    const timeline = document.getElementById('timeline');
    timeline.innerHTML = broadcastData.sections.map((_, i) => `
      <div class="timeline-dot ${i < currentSection ? 'done' : ''} ${i === currentSection ? 'active' : ''}"></div>
    `).join('');
  }

  function goTo(index) {
    if (index < 0 || index >= broadcastData.sections.length) return;
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    currentSection = index;
    const newSection = document.querySelector(`.section[data-index="${index}"]`);
    if (newSection) {
      newSection.classList.add('active');
      const bg = newSection.querySelector('.bg-image');
      if (bg) {
        bg.style.animation = 'none';
        bg.offsetHeight;
        bg.style.animation = '';
      }
    }
    renderTimeline();
  }

  function next() { if (currentSection < broadcastData.sections.length - 1) goTo(currentSection + 1); }
  function prev() { if (currentSection > 0) goTo(currentSection - 1); }

  // ì´ë²¤íŠ¸
  document.getElementById('touchRight').addEventListener('click', next);
  document.getElementById('touchLeft').addEventListener('click', prev);
  document.addEventListener('keydown', (e) => {
    if (!document.getElementById('broadcastMode').classList.contains('active')) return;
    if (e.key === 'ArrowRight' || e.key === ' ') next();
    if (e.key === 'ArrowLeft') prev();
    if (e.key === 'Escape') exitBroadcast();
  });

  let touchStartX = 0;
  document.addEventListener('touchstart', (e) => { touchStartX = e.touches[0].clientX; });
  document.addEventListener('touchend', (e) => {
    if (!document.getElementById('broadcastMode').classList.contains('active')) return;
    const diff = touchStartX - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) { if (diff > 0) next(); else prev(); }
  });

  // ì´ˆê¸°í™”
  renderSectionCards();
  loadData();
</script>
</body>
</html>
