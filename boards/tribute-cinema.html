<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <title>Tribute Cinema Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --black: #000000;
      --void: #050505;
      --dark: #0a0a0a;
      --surface: #111111;
      --elevated: #1a1a1a;
      --border: rgba(255,255,255,0.08);
      --white: #f5f5f0;
      --cream: #e8e4dc;
      --muted: rgba(255,255,255,0.5);
      --dim: rgba(255,255,255,0.25);
      --gold: #c9a962;
      --gold-dim: rgba(201,169,98,0.3);
      --serif: 'Cormorant Garamond', Georgia, serif;
      --sans: 'Inter', -apple-system, sans-serif;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html { width: 100%; height: 100%; }

    body {
      width: 100%;
      min-height: 100%;
      background: var(--void);
      color: var(--white);
      font-family: var(--sans);
      padding: 1rem;
      padding-bottom: 6rem;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .container { max-width: 600px; margin: 0 auto; }

    header {
      text-align: center;
      padding: 1.5rem 0 2rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }

    .tag {
      font-size: 0.5625rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--gold);
      background: var(--gold-dim);
      padding: 0.25rem 0.5rem;
      display: inline-block;
      margin-bottom: 0.75rem;
    }

    h1 {
      font-family: var(--serif);
      font-size: 1.5rem;
      font-weight: 400;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .subtitle { font-size: 0.75rem; color: var(--muted); }

    /* Sections */
    .section {
      background: var(--surface);
      border: 1px solid var(--border);
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--elevated);
      cursor: pointer;
      user-select: none;
    }

    .section-title {
      font-size: 0.6875rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--gold);
    }

    .section-toggle {
      font-size: 0.75rem;
      color: var(--dim);
      transition: transform 0.2s;
    }

    .section.collapsed .section-toggle { transform: rotate(-90deg); }
    .section.collapsed .section-body { display: none; }

    .section-body { padding: 1rem; }

    /* Form */
    .form-group { margin-bottom: 1rem; }
    .form-group:last-child { margin-bottom: 0; }

    .form-label {
      display: block;
      font-size: 0.6875rem;
      font-weight: 500;
      color: var(--muted);
      margin-bottom: 0.375rem;
      letter-spacing: 0.05em;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      background: var(--dark);
      border: 1px solid var(--border);
      border-radius: 0;
      color: var(--white);
      font-family: var(--sans);
      font-size: 16px;
      -webkit-appearance: none;
    }

    .form-input:focus { outline: none; border-color: var(--gold); }
    .form-input::placeholder { color: var(--dim); }

    textarea.form-input {
      min-height: 80px;
      resize: vertical;
      line-height: 1.6;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .form-hint {
      font-size: 0.625rem;
      color: var(--dim);
      margin-top: 0.25rem;
    }

    /* Image List */
    .image-list { display: flex; flex-direction: column; gap: 0.75rem; }

    .image-item { display: flex; flex-direction: column; gap: 0.5rem; }

    .image-input-row { display: flex; gap: 0.5rem; align-items: center; }
    .image-input-row input { flex: 1; }

    .image-input-row button {
      padding: 0.875rem 1rem;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      cursor: pointer;
      font-size: 1rem;
      min-width: 44px;
      min-height: 44px;
    }

    .image-input-row button:hover { border-color: #c44; color: #c44; }

    .image-preview {
      width: 100%;
      aspect-ratio: 16/9;
      background: var(--dark);
      border: 1px solid var(--border);
      overflow: hidden;
      display: none;
    }

    .image-preview.loaded { display: block; }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-preview-error {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      font-size: 0.6875rem;
      color: var(--dim);
    }

    .add-image-btn {
      width: 100%;
      padding: 0.75rem;
      background: transparent;
      border: 1px dashed var(--border);
      color: var(--muted);
      font-size: 0.75rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .add-image-btn:hover { border-color: var(--gold); color: var(--gold); }

    /* Auto-save indicator */
    .autosave-indicator {
      position: fixed;
      top: 1rem;
      right: 1rem;
      font-size: 0.625rem;
      color: var(--gold);
      background: var(--surface);
      padding: 0.375rem 0.625rem;
      border: 1px solid var(--border);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 100;
    }

    .autosave-indicator.show { opacity: 1; }

    /* Duration */
    .duration-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .duration-option {
      padding: 0.75rem;
      background: var(--dark);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
    }

    .duration-option:hover,
    .duration-option.active {
      border-color: var(--gold);
      color: var(--gold);
    }

    /* Actions */
    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--void);
      border-top: 1px solid var(--border);
      padding: 1rem;
      display: flex;
      gap: 0.75rem;
      z-index: 100;
    }

    .btn {
      flex: 1;
      padding: 1rem;
      font-family: var(--sans);
      font-size: 0.8125rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      min-height: 48px;
    }

    .btn-secondary {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .btn-secondary:hover { border-color: var(--gold); color: var(--gold); }

    .btn-primary { background: var(--gold); color: var(--black); }
    .btn-primary:hover { filter: brightness(1.1); }

    /* Output */
    .output {
      display: none;
      margin-top: 1.5rem;
    }

    .output.active { display: block; }

    .output-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--gold-dim);
      border: 1px solid var(--gold);
      border-bottom: none;
    }

    .output-title {
      font-size: 0.6875rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--gold);
    }

    .output-code {
      width: 100%;
      min-height: 300px;
      padding: 1rem;
      background: var(--black);
      border: 1px solid var(--gold);
      color: var(--cream);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6875rem;
      line-height: 1.6;
      resize: vertical;
    }

    .output-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .output-hint {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--surface);
      border-left: 3px solid var(--gold);
      font-size: 0.75rem;
      color: var(--muted);
      line-height: 1.6;
    }

    footer {
      text-align: center;
      padding: 2rem 0;
      margin-top: 2rem;
      border-top: 1px solid var(--border);
    }

    .footer-link {
      font-size: 0.625rem;
      color: var(--muted);
      text-decoration: none;
    }

    .footer-link:hover { color: var(--gold); }
  </style>
</head>
<body>
  <div class="autosave-indicator" id="autosaveIndicator">저장됨 ✓</div>

  <div class="container">
    <header>
      <span class="tag">Chalkboard Generator</span>
      <h1>Tribute Cinema</h1>
      <p class="subtitle">데이터 입력 → 방송용 HTML 코드 생성 (자동 저장)</p>
    </header>

    <!-- Subject -->
    <div class="section" id="sectionSubject">
      <div class="section-header" onclick="toggleSection('sectionSubject')">
        <span class="section-title">인물 정보</span>
        <span class="section-toggle">▼</span>
      </div>
      <div class="section-body">
        <div class="form-group">
          <label class="form-label">이름</label>
          <input type="text" class="form-input" id="subjectName" placeholder="홍길동" oninput="autoSave()">
        </div>
        <div class="form-group">
          <label class="form-label">부제 / 직함</label>
          <input type="text" class="form-input" id="subjectTitle" placeholder="시대를 앞서간 선구자" oninput="autoSave()">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">출생</label>
            <input type="text" class="form-input" id="birthYear" placeholder="1950" oninput="autoSave()">
          </div>
          <div class="form-group">
            <label class="form-label">사망</label>
            <input type="text" class="form-input" id="deathYear" placeholder="2024" oninput="autoSave()">
          </div>
        </div>
      </div>
    </div>

    <!-- Duration -->
    <div class="section" id="sectionDuration">
      <div class="section-header" onclick="toggleSection('sectionDuration')">
        <span class="section-title">재생 설정</span>
        <span class="section-toggle">▼</span>
      </div>
      <div class="section-body">
        <div class="form-group">
          <label class="form-label">섹션당 시간</label>
          <div class="duration-grid">
            <div class="duration-option" data-duration="60">1분</div>
            <div class="duration-option active" data-duration="120">2분</div>
            <div class="duration-option" data-duration="180">3분</div>
          </div>
          <p class="form-hint">9개 섹션 × 2분 = 18분 러닝타임</p>
        </div>
      </div>
    </div>

    <!-- Sections Container -->
    <div id="sectionsContainer"></div>

    <!-- Output -->
    <div class="output" id="output">
      <div class="output-header">
        <span class="output-title">생성된 HTML 코드</span>
      </div>
      <textarea class="output-code" id="outputCode" readonly></textarea>
      <div class="output-actions">
        <button class="btn btn-secondary" onclick="copyCode()">복사</button>
        <button class="btn btn-secondary" onclick="downloadCode()">다운로드</button>
        <button class="btn btn-secondary" onclick="previewCode()">미리보기</button>
      </div>
      <div class="output-hint">
        <strong>사용법:</strong><br>
        1. [복사] → 새 HTML 파일에 붙여넣기<br>
        2. boards/이름-추모.html로 저장<br>
        3. GitHub에 푸시 → 라이브 URL로 녹화
      </div>
    </div>

    <footer>
      <a href="../prompts/chalkboard/" class="footer-link">← Chalkboard Archive</a>
    </footer>
  </div>

  <!-- Fixed Actions -->
  <div class="actions">
    <button class="btn btn-secondary" onclick="loadSample()">샘플</button>
    <button class="btn btn-primary" onclick="generateCode()">코드 생성</button>
  </div>

  <script>
    const SECTIONS = [
      { id: 'opening', chapter: 'OPENING', title: '오프닝', type: 'title' },
      { id: 'early', chapter: 'CHAPTER I', title: '유년 시절', heading: '시작의 기억' },
      { id: 'growth', chapter: 'CHAPTER II', title: '성장', heading: '꿈을 향한 여정' },
      { id: 'peak', chapter: 'CHAPTER III', title: '전성기', heading: '빛나는 순간들' },
      { id: 'legacy', chapter: 'CHAPTER IV', title: '업적', heading: '남긴 발자취' },
      { id: 'personal', chapter: 'CHAPTER V', title: '일상', heading: '가까이에서 본 모습' },
      { id: 'tributes', chapter: 'CHAPTER VI', title: '추억', heading: '그를 기억하는 사람들' },
      { id: 'final', chapter: 'CHAPTER VII', title: '마지막', heading: '영원한 안식' },
      { id: 'ending', chapter: 'IN MEMORY', title: '엔딩', type: 'ending' }
    ];

    let state = {
      subject: { name: '', title: '', birth: '', death: '' },
      duration: 120,
      sections: SECTIONS.map(s => ({
        ...s,
        quote: '',
        attribution: '',
        images: ['']
      }))
    };

    // Init
    function init() {
      const container = document.getElementById('sectionsContainer');
      SECTIONS.forEach((sec, idx) => {
        container.innerHTML += createSectionForm(sec, idx);
      });

      // Duration buttons
      document.querySelectorAll('[data-duration]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-duration]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.duration = parseInt(btn.dataset.duration);
          autoSave();
        });
      });

      // Load saved data or render initial images
      const loaded = loadSavedData();
      if (!loaded) {
        // Render empty image inputs for each section
        SECTIONS.forEach((_, idx) => renderImages(idx));
      }
    }

    function createSectionForm(sec, idx) {
      const isSpecial = sec.type === 'title' || sec.type === 'ending';
      return `
        <div class="section collapsed" id="section${idx}">
          <div class="section-header" onclick="toggleSection('section${idx}')">
            <span class="section-title">${sec.chapter} — ${sec.title}</span>
            <span class="section-toggle">▼</span>
          </div>
          <div class="section-body">
            ${!isSpecial ? `
              <div class="form-group">
                <label class="form-label">섹션 제목</label>
                <input type="text" class="form-input" id="heading${idx}" placeholder="${sec.heading || ''}" oninput="updateSection(${idx}, 'heading', this.value); autoSave();">
              </div>
              <div class="form-group">
                <label class="form-label">인용문</label>
                <textarea class="form-input" id="quote${idx}" placeholder="이 시기를 대표하는 말..." oninput="updateSection(${idx}, 'quote', this.value); autoSave();"></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">출처 (선택)</label>
                <input type="text" class="form-input" id="attr${idx}" placeholder="— 누구의 말" oninput="updateSection(${idx}, 'attribution', this.value); autoSave();"></textarea>
              </div>
            ` : ''}
            <div class="form-group">
              <label class="form-label">이미지 URL</label>
              <div class="image-list" id="images${idx}"></div>
              <button class="add-image-btn" onclick="addImage(${idx})">+ 이미지 추가</button>
            </div>
          </div>
        </div>
      `;
    }

    function toggleSection(id) {
      document.getElementById(id).classList.toggle('collapsed');
    }

    function updateSection(idx, field, value) {
      state.sections[idx][field] = value;
    }

    function updateImage(idx, imgIdx, value) {
      state.sections[idx].images[imgIdx] = value;
      updateImagePreview(idx, imgIdx, value);
      autoSave();
    }

    function addImage(idx) {
      state.sections[idx].images.push('');
      renderImages(idx);
      autoSave();
    }

    function removeImage(idx, imgIdx) {
      if (state.sections[idx].images.length > 1) {
        state.sections[idx].images.splice(imgIdx, 1);
        renderImages(idx);
        autoSave();
      }
    }

    function renderImages(idx) {
      const list = document.getElementById(`images${idx}`);
      list.innerHTML = state.sections[idx].images.map((img, i) => `
        <div class="image-item">
          <div class="image-input-row">
            <input type="text" class="form-input" id="imgInput${idx}_${i}" value="${img}" placeholder="https://..." oninput="updateImage(${idx}, ${i}, this.value)">
            <button onclick="removeImage(${idx}, ${i})">✕</button>
          </div>
          <div class="image-preview ${img ? 'loaded' : ''}" id="imgPreview${idx}_${i}">
            ${img ? `<img src="${img}" onerror="this.parentElement.innerHTML='<div class=\\'image-preview-error\\'>이미지 로드 실패</div>'" alt="미리보기">` : ''}
          </div>
        </div>
      `).join('');
    }

    function updateImagePreview(idx, imgIdx, url) {
      const preview = document.getElementById(`imgPreview${idx}_${imgIdx}`);
      if (!preview) return;

      if (url && url.startsWith('http')) {
        preview.classList.add('loaded');
        preview.innerHTML = `<img src="${url}" onerror="this.parentElement.innerHTML='<div class=\\'image-preview-error\\'>이미지 로드 실패</div>'" alt="미리보기">`;
      } else {
        preview.classList.remove('loaded');
        preview.innerHTML = '';
      }
    }

    // Auto-save
    let saveTimeout = null;
    function autoSave() {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        collectData();
        localStorage.setItem('tribute-cinema-state', JSON.stringify(state));
        showSaveIndicator();
      }, 500);
    }

    function showSaveIndicator() {
      const indicator = document.getElementById('autosaveIndicator');
      indicator.classList.add('show');
      setTimeout(() => indicator.classList.remove('show'), 1500);
    }

    function loadSavedData() {
      const saved = localStorage.getItem('tribute-cinema-state');
      if (!saved) return false;

      try {
        const data = JSON.parse(saved);
        state = { ...state, ...data };

        // Restore subject info
        document.getElementById('subjectName').value = state.subject.name || '';
        document.getElementById('subjectTitle').value = state.subject.title || '';
        document.getElementById('birthYear').value = state.subject.birth || '';
        document.getElementById('deathYear').value = state.subject.death || '';

        // Restore duration
        document.querySelectorAll('[data-duration]').forEach(btn => {
          btn.classList.toggle('active', parseInt(btn.dataset.duration) === state.duration);
        });

        // Restore sections
        state.sections.forEach((sec, idx) => {
          const h = document.getElementById(`heading${idx}`);
          const q = document.getElementById(`quote${idx}`);
          const a = document.getElementById(`attr${idx}`);
          if (h) h.value = sec.heading || '';
          if (q) q.value = sec.quote || '';
          if (a) a.value = sec.attribution || '';
          renderImages(idx);
        });

        return true;
      } catch(e) {
        return false;
      }
    }

    function collectData() {
      state.subject.name = document.getElementById('subjectName').value;
      state.subject.title = document.getElementById('subjectTitle').value;
      state.subject.birth = document.getElementById('birthYear').value;
      state.subject.death = document.getElementById('deathYear').value;

      state.sections.forEach((sec, idx) => {
        const h = document.getElementById(`heading${idx}`);
        const q = document.getElementById(`quote${idx}`);
        const a = document.getElementById(`attr${idx}`);
        if (h) sec.heading = h.value || SECTIONS[idx].heading || '';
        if (q) sec.quote = q.value;
        if (a) sec.attribution = a.value;
      });
    }

    function loadSample() {
      document.getElementById('subjectName').value = '김철수';
      document.getElementById('subjectTitle').value = '한국 현대사의 거인';
      document.getElementById('birthYear').value = '1945';
      document.getElementById('deathYear').value = '2024';

      const sampleData = [
        { images: ['https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1600'] },
        { heading: '시골 마을의 아이', quote: '어린 시절의 기억은 언제나 따뜻한 햇살과 함께한다.', attribution: '— 1960년 일기에서', images: ['https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1600'] },
        { heading: '배움의 길', quote: '지식은 힘이다. 그러나 그 힘은 나눌 때 비로소 의미를 갖는다.', attribution: '— 1975년 졸업식 연설', images: ['https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=1600'] },
        { heading: '정상에 서다', quote: '성공이란 결코 혼자 이루는 것이 아니다.', attribution: '— 1990년 수상 소감', images: ['https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1600'] },
        { heading: '남긴 것들', quote: '내가 떠난 후에도 이 일이 계속되기를.', attribution: '— 2020년 인터뷰', images: ['https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=1600'] },
        { heading: '아버지, 남편, 친구', quote: '그는 항상 가족을 먼저 생각했습니다.', attribution: '— 가족의 회고', images: ['https://images.unsplash.com/photo-1511895426328-dc8714191300?w=1600'] },
        { heading: '그를 기억하며', quote: '그와 함께한 시간은 제 인생의 가장 큰 선물이었습니다.', attribution: '— 동료의 추모사', images: ['https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1600'] },
        { heading: '영원한 안식', quote: '이제 편히 쉬십시오. 당신이 뿌린 씨앗은 영원히 자라날 것입니다.', attribution: '', images: ['https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=1600'] },
        { images: ['https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=1600'] }
      ];

      sampleData.forEach((data, idx) => {
        state.sections[idx].images = data.images;
        if (data.heading) state.sections[idx].heading = data.heading;
        if (data.quote) state.sections[idx].quote = data.quote;
        if (data.attribution) state.sections[idx].attribution = data.attribution;

        const h = document.getElementById(`heading${idx}`);
        const q = document.getElementById(`quote${idx}`);
        const a = document.getElementById(`attr${idx}`);
        if (h) h.value = data.heading || '';
        if (q) q.value = data.quote || '';
        if (a) a.value = data.attribution || '';
        renderImages(idx);
      });

      alert('샘플 데이터 로드 완료');
    }

    function generateCode() {
      collectData();

      const html = generateBroadcastHTML();
      document.getElementById('outputCode').value = html;
      document.getElementById('output').classList.add('active');
      document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
    }

    function generateBroadcastHTML() {
      const { subject, duration, sections } = state;
      const KB = ['kb-zoom-in', 'kb-zoom-out', 'kb-pan-left', 'kb-pan-right', 'kb-pan-up'];

      const slidesHTML = sections.map((sec, idx) => {
        const kb = KB[idx % KB.length];
        const img = sec.images[0] || '';

        if (sec.type === 'title') {
          return `
    <div class="slide ${kb}" data-idx="${idx}">
      <div class="slide-bg"><img src="${img}" class="slide-img" alt=""></div>
      <div class="slide-content">
        <h1 class="title-name">${subject.name}</h1>
        <p class="title-sub">${subject.title}</p>
        <p class="title-years">${subject.birth} — ${subject.death}</p>
      </div>
    </div>`;
        }

        if (sec.type === 'ending') {
          return `
    <div class="slide ${kb}" data-idx="${idx}">
      <div class="slide-bg"><img src="${img}" class="slide-img" alt=""></div>
      <div class="slide-content ending">
        <div class="ending-line"></div>
        <p class="ending-text">In Loving Memory</p>
        <h2 class="ending-name">${subject.name}</h2>
        <p class="ending-years">${subject.birth} — ${subject.death}</p>
      </div>
    </div>`;
        }

        return `
    <div class="slide ${kb}" data-idx="${idx}">
      <div class="slide-bg"><img src="${img}" class="slide-img" alt=""></div>
      <div class="slide-content">
        <p class="chapter">${sec.chapter}</p>
        <h2 class="heading">${sec.heading}</h2>
        ${sec.quote ? `<p class="quote">"${sec.quote}"</p>` : ''}
        ${sec.attribution ? `<p class="attribution">${sec.attribution}</p>` : ''}
      </div>
    </div>`;
      }).join('\n');

      return `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${subject.name} — Tribute</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,400&family=Inter:wght@300;400&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;color:#f5f5f0}
    .grain{position:fixed;inset:0;pointer-events:none;z-index:100;opacity:0.04;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
    .vignette{position:fixed;inset:0;pointer-events:none;z-index:99;background:radial-gradient(ellipse at center,transparent 0%,transparent 50%,rgba(0,0,0,0.7) 100%)}
    .slide{position:absolute;inset:0;opacity:0;visibility:hidden;transition:opacity 1.5s,visibility 1.5s}
    .slide.active{opacity:1;visibility:visible}
    .slide-bg{position:absolute;inset:0;overflow:hidden}
    .slide-img{position:absolute;inset:-10%;width:120%;height:120%;object-fit:cover;filter:brightness(0.6) contrast(1.1)}
    @keyframes kb-zoom-in{from{transform:scale(1)}to{transform:scale(1.15)}}
    @keyframes kb-zoom-out{from{transform:scale(1.15)}to{transform:scale(1)}}
    @keyframes kb-pan-left{from{transform:translateX(5%) scale(1.08)}to{transform:translateX(-5%) scale(1.08)}}
    @keyframes kb-pan-right{from{transform:translateX(-5%) scale(1.08)}to{transform:translateX(5%) scale(1.08)}}
    @keyframes kb-pan-up{from{transform:translateY(5%) scale(1.08)}to{transform:translateY(-5%) scale(1.08)}}
    .kb-zoom-in .slide-img{animation:kb-zoom-in ${duration}s ease-out forwards}
    .kb-zoom-out .slide-img{animation:kb-zoom-out ${duration}s ease-out forwards}
    .kb-pan-left .slide-img{animation:kb-pan-left ${duration}s ease-in-out forwards}
    .kb-pan-right .slide-img{animation:kb-pan-right ${duration}s ease-in-out forwards}
    .kb-pan-up .slide-img{animation:kb-pan-up ${duration}s ease-in-out forwards}
    .slide-content{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:2rem}
    .title-name{font-family:'Cormorant Garamond',serif;font-size:clamp(2.5rem,8vw,5rem);font-weight:300;letter-spacing:0.1em;text-shadow:0 4px 30px rgba(0,0,0,0.8)}
    .title-sub{font-family:'Cormorant Garamond',serif;font-size:clamp(1rem,3vw,1.5rem);font-style:italic;color:#e8e4dc;margin-top:0.5rem;text-shadow:0 2px 20px rgba(0,0,0,0.8)}
    .title-years{font-family:'Inter',sans-serif;font-size:clamp(0.875rem,2vw,1.125rem);letter-spacing:0.3em;color:#c9a962;margin-top:2rem;text-shadow:0 2px 20px rgba(0,0,0,0.8)}
    .chapter{font-family:'Inter',sans-serif;font-size:0.625rem;letter-spacing:0.3em;text-transform:uppercase;color:#c9a962;margin-bottom:1.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.8)}
    .heading{font-family:'Cormorant Garamond',serif;font-size:clamp(1.75rem,5vw,3rem);font-weight:400;letter-spacing:0.05em;margin-bottom:1.5rem;text-shadow:0 4px 30px rgba(0,0,0,0.8)}
    .quote{font-family:'Cormorant Garamond',serif;font-size:clamp(1.125rem,3vw,1.75rem);font-style:italic;color:#e8e4dc;max-width:800px;line-height:1.6;text-shadow:0 2px 20px rgba(0,0,0,0.8)}
    .attribution{font-family:'Inter',sans-serif;font-size:0.75rem;color:rgba(255,255,255,0.5);margin-top:1.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.8)}
    .ending{text-align:center}
    .ending-line{width:60px;height:1px;background:#c9a962;margin:0 auto 2rem}
    .ending-text{font-family:'Cormorant Garamond',serif;font-size:clamp(1.5rem,4vw,2.5rem);font-style:italic;color:#e8e4dc}
    .ending-name{font-family:'Cormorant Garamond',serif;font-size:clamp(2rem,6vw,4rem);letter-spacing:0.15em;margin:2rem 0}
    .ending-years{font-family:'Inter',sans-serif;font-size:1rem;letter-spacing:0.4em;color:#c9a962}
    .progress{position:fixed;bottom:0;left:0;right:0;height:3px;background:rgba(255,255,255,0.1);z-index:50}
    .progress-bar{height:100%;background:#c9a962;width:0%;transition:width 0.3s}
    .timeline{position:fixed;right:1.5rem;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:0.75rem;z-index:50}
    .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);cursor:pointer;transition:all 0.3s}
    .dot.active{background:#c9a962;border-color:#c9a962;box-shadow:0 0 10px rgba(201,169,98,0.3)}
    @media(max-width:640px){.timeline{display:none}}
  </style>
</head>
<body>
  <div class="grain"></div>
  <div class="vignette"></div>
  <div class="timeline" id="timeline"></div>
  <div id="slides">${slidesHTML}
  </div>
  <div class="progress"><div class="progress-bar" id="progress"></div></div>
  <script>
    const DURATION = ${duration} * 1000;
    const slides = document.querySelectorAll('.slide');
    const total = slides.length;
    let current = 0;
    let timer = null;

    function init() {
      document.getElementById('timeline').innerHTML = Array.from({length: total}, (_, i) =>
        '<div class="dot' + (i === 0 ? ' active' : '') + '" onclick="goTo(' + i + ')"></div>'
      ).join('');
      show(0);
      timer = setInterval(next, DURATION);
    }

    function show(idx) {
      slides.forEach((s, i) => s.classList.toggle('active', i === idx));
      document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === idx));
      document.getElementById('progress').style.width = ((idx + 1) / total * 100) + '%';
      current = idx;
    }

    function next() { show(current < total - 1 ? current + 1 : current); }
    function prev() { show(current > 0 ? current - 1 : current); }
    function goTo(idx) { show(idx); }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowRight' || e.key === ' ') next();
      if (e.key === 'ArrowLeft') prev();
    });

    let touchX = 0;
    document.addEventListener('touchstart', e => touchX = e.touches[0].clientX);
    document.addEventListener('touchend', e => {
      const diff = touchX - e.changedTouches[0].clientX;
      if (Math.abs(diff) > 50) diff > 0 ? next() : prev();
    });

    init();
  <\\/script>
</body>
</html>`;
    }

    function copyCode() {
      const code = document.getElementById('outputCode');
      code.select();
      document.execCommand('copy');
      alert('복사 완료!');
    }

    function downloadCode() {
      const code = document.getElementById('outputCode').value;
      const name = state.subject.name || 'tribute';
      const blob = new Blob([code], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name}-tribute.html`;
      a.click();
    }

    function previewCode() {
      const code = document.getElementById('outputCode').value;
      const win = window.open('', '_blank');
      win.document.write(code);
      win.document.close();
    }

    init();
  </script>
</body>
</html>
